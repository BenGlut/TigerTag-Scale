[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
upload_protocol = esptool

# ============================================
# FILESYSTEM CONFIGURATION
# ============================================
board_build.filesystem = littlefs
board_build.partitions = partitions.csv

# ============================================
# BUILD AUTOMATION
# ============================================
# Script exécuté automatiquement avant chaque build
extra_scripts = 
    pre:scripts/build_web.py

# ============================================
# LIBRARIES
# ============================================
lib_deps = 
    tzapu/WiFiManager @ ^2.0.16-rc.2
    me-no-dev/ESPAsyncWebServer @ ^1.2.3
    me-no-dev/AsyncTCP @ ^1.1.1
    adafruit/Adafruit SSD1306 @ ^2.5.7
    adafruit/Adafruit GFX Library @ ^1.11.3
    bogde/HX711 @ ^0.7.5
    miguelbalboa/MFRC522 @ ^1.4.10

# ============================================
# COMPILATION FLAGS
# ============================================
build_flags = 
    -D CONFIG_LITTLEFS_FOR_IDF_3_2
    -Os  ; Optimisation taille (important pour ESP32)

# ============================================
# UPLOAD SETTINGS
# ============================================
upload_speed = 921600
monitor_speed = 115200

# Filtres moniteur série (optionnel)
monitor_filters = 
    esp32_exception_decoder
    colorize

# ============================================
# NOTES IMPORTANTES
# ============================================
# 1. Pour uploader le filesystem (fichiers web):
#    pio run --target uploadfs
#
# 2. Pour uploader le firmware uniquement:
#    pio run --target upload
#
# 3. Pour tout uploader (firmware + filesystem):
#    pio run -t upload -t uploadfs
#
# 4. Les fichiers web dans web-src/ sont automatiquement
#    compressés et placés dans data/www/ avant chaque build